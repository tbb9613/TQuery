<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
</head>
<body>
    <svg></svg>
</body>
<script>
    var width= 300;
    var height = 100;
    // var margin = ({top: 20, right: 20, bottom: 30, left: 30});
    
        // .attr("transform", `translate${margin.left}, ${margin.top}`)

    
    d3.csv("aapl.csv", d3.autoType).then(function(data){

        console.log(data)
        var svg = d3.select("svg").attr("width", width).attr("height", height);
        var areachart  = svg.append("g").attr("id", "area").attr("transform", `translate(50, 10)`)

        // console.log(data);


        let x = d3.scaleUtc()
            .domain(d3.extent(data, d => d.date))
            .range([0, width-20])

        let y = d3.scaleLinear()
            .domain([0, d3.max(data, d => d.close)]).nice()
            .range([height-30, 0])

        console.log(d3.max(data, d => d.close));

        areachart.append("g")
            .attr("transform", `translate(0, ${height-30})`)
            .call(d3.axisBottom(x).ticks(width / 80).tickSizeOuter(0))

        areachart.append("g")
        
            .call(d3.axisLeft(y).ticks(height/50))    

        areachart
            .append("g")
            .attr("id", "pathh")
            .datum(data)
            .append("path")
            .attr("fill", "#cce5df")
            .attr("stroke", "#69b3a2")
            .attr("stroke-width", 1.5)
            .attr("d", d3.area()
                // .curve()
                .x(function(d) { return x(d.date) })
                .y0(y(0))
                .y1(function(d) { return y(d.close) })
                )

        const brush = d3.brushX()
            .extent([[0,0], [width, height-30]])
            .on("start brush end", brushmoved);
        
            var gBrush = areachart.append("g")
            .attr("class", "brush")


        // style brush resize handle
// https://github.com/crossfilter/crossfilter/blob/gh-pages/index.html#L466
        var brushResizePath = function(d) {
            var e = +(d.type == "e"),
                x = e ? 1 : -1,
                y = (height-30) / 2;
            return "M" + (.5 * x) + "," + y + "A6,6 0 0 " + e + " " + (6.5 * x) + "," + (y + 6) + "V" + (2 * y - 6) + "A6,6 0 0 " + e + " " + (.5 * x) + "," + (2 * y) + "Z" + "M" + (2.5 * x) + "," + (y + 8) + "V" + (2 * y - 8) + "M" + (4.5 * x) + "," + (y + 8) + "V" + (2 * y - 8);
        }

        var handle = gBrush.selectAll(".handle-custom")
            .data([{type: "w"}, {type: "e"}])
            .enter().append("path")
                .attr("class", "handle-custom")
                .attr("stroke", "#000")
                .attr("cursor", "ew-resize")
                .attr("d", brushResizePath);

        gBrush.call(brush)
            .call(brush.move, [100,200]);

        // console.log(handle);
        
        let x0 = width/2-50, x1 = width/2+50
        function brushmoved() {
                var s = d3.event.selection;
                console.log(x.invert(s[0]));
                // const [x0, x1] = s.map(x.invert);
                if (s == null) {
                    handle.attr("display", "none");
                    // circle.classed("active", false);
                } else {
                    // var sx = s.map(x.invert);
                    // circle.classed("active", function(d) { return sx[0] <= d && d <= sx[1]; });
                    console.log(handle);
                    handle.attr("display", null).attr("transform", function(d, i) { return "translate(" + [ s[i], - (height-30) / 4] + ")"; });
                }
        };

});

</script>
</html>